<div class="modal-header">
  <h4 class="modal-title">Comprar Ingresso</h4>
  <button type="button" class="btn-close" aria-label="Close" (click)="activeModal.dismiss('closed')"></button>
</div>

<div class="modal-body">
  <div class="stepper-container">
    <div class="stepper">
      <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
        <div class="step-number">1</div>
        <div class="step-title">Dados do comprador</div>
      </div>
      <div class="step-connector"></div>
      <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
        <div class="step-number">2</div>
        <div class="step-title">Revisão da compra</div>
      </div>
      <div class="step-connector"></div>
      <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3">
        <div class="step-number">3</div>
        <div class="step-title">Pagamento</div>
      </div>
      <div class="step-connector"></div>
      <div class="step" [class.active]="currentStep === 4">
        <div class="step-number">4</div>
        <div class="step-title">Download Ingresso</div>
      </div>
    </div>
  </div>

  <!-- Step 1: Formulário de Dados -->
  <div class="step-content" *ngIf="currentStep === 1">
    <div class="contact-form">
      <h5 class="form-section-title">Informações do Comprador</h5>
      <div class="form-group">
        <label for="name">Nome Completo</label>
        <input type="text" class="form-control" id="name" [(ngModel)]="contactInfo.name" placeholder="Digite seu nome">
      </div>
      <div class="form-group">
        <label for="email">E-mail</label>
        <input type="email" class="form-control" id="email" [(ngModel)]="contactInfo.email" placeholder="Digite seu e-mail">
      </div>
      <div class="form-group">
        <label for="phone">Telefone</label>
        <input type="tel" class="form-control" id="phone" [(ngModel)]="contactInfo.phone" (input)="formatPhone($event)" placeholder="(00) 00000-0000">
      </div>
    </div>
  </div>

  <!-- Step 2: Revisão dos Dados -->
  <div class="step-content" *ngIf="currentStep === 2">
    <div class="review-container">
      <h5 class="mb-4">Revise seus Dados</h5>
      
      <div class="ticket-details mb-4">
        <h6>Detalhes do Ingresso</h6>
        <div class="info-box">
          <p><strong>Evento:</strong> {{ticket.eventName}}</p>
          <p><strong>Local:</strong> {{ticket.venue}}</p>
          <p><strong>Data:</strong> {{ticket.eventDate}}</p>
          <p><strong>Tipo:</strong> {{ticket.ticketType}}</p>
          <p><strong>Valor:</strong> R$ {{ticket.price}},00</p>
        </div>
      </div>

      <div class="buyer-details">
        <h6>Dados do Comprador</h6>
        <div class="info-box">
          <p><strong>Nome:</strong> {{contactInfo.name}}</p>
          <p><strong>Email:</strong> {{contactInfo.email}}</p>
          <p><strong>Telefone:</strong> {{contactInfo.phone}}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Step 3: QR Code e Pagamento -->
  <div class="step-content" *ngIf="currentStep === 3">
    <div class="payment-container text-center">
      <div *ngIf="!showQrCode" class="loading-container">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Carregando...</span>
        </div>
        <p class="mt-3">Gerando QR Code para pagamento...</p>
        <div class="alert alert-info mt-3">
          <i class="fas fa-info-circle"></i>
          Você poderá pagar usando PIX através do QR Code que será exibido em instantes.
        </div>
      </div>
      <div *ngIf="showQrCode" class="qr-code-container">
        <img [src]="qrCodeUrl" alt="QR Code para pagamento" class="qr-code-image">
        <div class="timer mt-3">Tempo restante: {{ formatTime(remainingTime) }}</div>
        <button class="btn btn-outline-primary mt-3" (click)="copyQRCode()">
          {{ copySuccess ? 'Copiado!' : 'Copiar código Pix' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Step 3: Download do Ingresso -->
  <div class="step-content" *ngIf="currentStep === 3">
    <div class="ticket-download text-center">
      <div *ngIf="paymentStatus === 'approved'" class="success-message">
        <i class="fas fa-check-circle success-icon"></i>
        <h5>Pagamento Aprovado!</h5>
        <p>Seu ingresso está pronto para download</p>
        <button class="btn btn-primary mt-3" (click)="downloadTicket()">
          <i class="fas fa-download"></i> Baixar Ingresso
        </button>
      </div>
      <div *ngIf="paymentStatus === 'pending'" class="pending-message">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Aguardando confirmação do pagamento...</p>
      </div>
      <div *ngIf="paymentStatus === 'failed'" class="error-message">
        <i class="fas fa-times-circle error-icon"></i>
        <p>Houve um problema com o pagamento</p>
        <button class="btn btn-outline-primary mt-3" (click)="retryPayment()">
          Tentar Novamente
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-secondary" (click)="activeModal.dismiss('cancel')" *ngIf="currentStep === 1">
    Cancelar
  </button>
  <button type="button" class="btn btn-primary" (click)="nextStep()" *ngIf="currentStep === 1" [disabled]="!isFormValid()">
    Próximo
  </button>
  <button type="button" class="btn btn-primary" (click)="finishPurchase()" *ngIf="currentStep === 3 && paymentStatus === 'approved'">
    Finalizar
  </button>
</div>